<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{ name }} League Stats</title>
        <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/icon.png') }}">
        <link rel="stylesheet" type= "text/css" href="{{ url_for('static', filename='styles/home.css') }}">
        <link rel="stylesheet" type= "text/css" href="{{ url_for('static', filename='styles/home_content.css') }}">
        <link rel="stylesheet" type= "text/css" href="{{ url_for('static', filename='styles/_power_rankings.css') }}">
        <link rel="stylesheet" type= "text/css" href="{{ url_for('static', filename='styles/_spinner.css') }}">
        <link rel="stylesheet" type= "text/css" href="{{ url_for('static', filename='styles/_leaderboards.css') }}">
        <link rel="stylesheet" type= "text/css" href="{{ url_for('static', filename='styles/_trade_box.css') }}">
    </head>
    <body>
        <div class="background-layer">
            <div class="content-container">
                <div class="content">

                    <!-- Header information -->
                    <div class="league-info">
                        <div class="league-title">League {{ name }}</div>
                        <div class="league-subinfo">

                            <!-- Season select dropdown -->
                            <select id="season-select">
                                {% for season in seasons %}
                                    {% set index = loop.index %}
                                    <option value="{{ season }}" {% if season == selected_season %}selected{% endif %}>
                                        Season {{ index }} ({{ season }})
                                    </option>
                                {% endfor %}
                            </select>

                            <!-- Last season champion -->
                            <div>
                                Last Season's Champion: 
                                {% if previous_winner %}
                                    {{ previous_winner[0] }} ({{ previous_winner[1][0] }}-{{ previous_winner[1][2] }}-{{ previous_winner[1][1] }})
                                {% else %}
                                    N/A
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <hr>

                    <!-- Loading overlay for season select (Hidden) -->
                    <div id="season-loading-container">
                        <p id="loading-season"></p>
                        <div class="spinner">
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </div>

                    <!-- Season information and widgets -->
                    <div id="season-info">

                        <!-- Power rankings -->
                        <div class="power-rankings-container">
                            {% with current_week=current_week, power_rankings=power_rankings %}
                                {% include "_power_rankings.html" %}
                            {% endwith %}
                        </div>
                        <hr>

                        <!-- Loading overlay for stat leaderboards (Hidden) -->
                        <p class="leaderboards-header">Leaderboards</p>
                        <div class="load-leaderboards-button-container">
                            <button id="load-leaderboards-button">Load Leaderboards</button>
                        </div>
                        <div id="leaderboards-loading-container">
                            <p class="loading-leaderboards">Loading leaderboards... This may take a minute</p>
                            <div class="spinner">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </div>

                        <!-- All stat leaderboards -->
                        <div id="leaderboards-container"></div>
                        <hr>

                        <!-- Loading overlay for stat luck index (Hidden) -->
                        <p class="luck-header">Luck Index</p>
                        {% if selected_season == current_year %}
                            <div class="luck-button-container">
                                <button id="luck-button">Load Luck Index</button>
                            </div>
                        {% else %}
                            <p class="feature-unavailable">Luck index unavailable for previous seasons.</p>
                        {% endif %}
                        <div id="luck-loading-container">
                            <p class="loading-luck">Loading luck index... This may take a minute</p>
                            <div class="spinner">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </div>

                        <!-- Luck Index -->
                        <div id="luck-container"></div>
                        <div class="luck-index-tip">
                            The luck index builds a comprehensive view of how much of a team's success or failure can be attributed to luck rather than skill or decision making. A higher luck index indicates more favorable circumstances that helped the team while a lower index reflects unfavorable conditions<br><br>
                            Current factors of the luck index include:<br>
                            <ol class="luck-index-tip-factors">
                                <li><b>Scheduling <u>(Weighted 30%)</u></b> Evaluates the difficulty of a team's matchups in a given week. Playing weaker teams suggests luck while tougher opponents imply unluckiness</li>
                                <li><b>Performace vs. Historical Average <u>(Weighted 10%)</u></b>  Compares a team's score to their usual performance. Scoring much higher than average suggests luck while scoring lower indicates bad luck</li>
                                <li><b>Margin of victory <u>(Weighted 25%)</u></b> Measures how much a team won or lost by. A narrow win suggests luck, while a decisive win implies dominance</li>
                                <li><b>Performance vs. Projections <u>(Weighted 10%)</u></b>: Measures a team's actual performance compared to their projections. Overperforming suggests luck, while underperforming implies the opposite</li>
                                <li><b>Injury/Bye Factor <u>(Weighted 10%)</u></b>: Considers the impact of unavailable players. Winning despite injuries or byes is seen as lucky</li>
                                <li><b>Optimal vs. Actual Lineup <u>(Weighted 10%)</u></b>: Analyzes if a team could have done better with a different lineup. Losing despite using the best lineup suggests bad luck, while winning because the opponent didn't set their best lineup indicates luck</li>
                                <li><b>Optimal vs. Optimal Lineup <u>(Weighted 5%)</u></b>: Compares the best lineups for both teams. Winning when both teams used their best lineups indicates skill, while winning despite not being optimal suggests luck</li>
                            </ol>
                        </div>
                        <hr>

                        <!-- Trade Tracker-->
                        <p class="trade-tracker-header">Trade Tracker</p>
                        {% if selected_season == current_year %}
                            {% for trade_date, trade_data in trades.items() %}
                                <div class="trade" data-epoch="{{ trade_date }}">
                                    {% with trade_date=trade_date, trade_data=trade_data %}
                                        {% include "_trade_box.html" %}
                                    {% endwith %}
                                </div>
                            {% endfor %}
                        {% elif trades != None and trades|length == 0 %}
                            <p class="trades-none">No trades yet.</p>
                        {% else %}
                            <p class="feature-unavailable">Trade tracker unavailable for previous seasons.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <script src="{{ url_for('static', filename='scripts/home.js') }}"></script>
    </body>
</html>
